<div class="row-fluid">
    <div id="dashboard" class="span12">
        <h2>Datasets <small>{{ dataset_count }} total</small></h2>
        <div class="row-fluid">
            <div class="span6">
                <h3>Without descriptions</h3>
                <ul>
                {% for name, slug in datasets_without_descriptions %}
                    <li><a href="#dataset/{{ slug }}">{{ name }}</a></li>
                {% endfor %}
                </ul>
            </div>
            <div class="span6">
                <h3>Without categories</h3>
                <ul>
                    {% for name, slug in datasets_without_categories %}
                    <li><a href="#dataset/{{ slug }}">{{ name }}</a></li>
                {% endfor %}
                </ul>
            </div>
        </div>

        <h2>Users <small>{{ user_count }} total{% if inactive_user_count %}, {{ inactive_user_count }} not activated{% endif %}</small></h2>
        <div class="row-fluid">
            <div class="span12">
                <h3>Users active over last 30 days</h3>
                <ul>
                    {% for activity in active_users_by_day %}
                    <li>{{ activity.when }} - {{ activity.id__count }} user{{ activity.id__count|pluralize }} {{ activity.id__count|pluralize:"was,were" }} active</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span6">
                <h3>Most active users in the last 30 days</h3>
                <ul>
                    {% for user in most_active_users %}
                    <li><a href="mailto:{{ user.email }}">{{ user.email }}</a> (used on {{ user.activity_logs__count }} day{{ user.activity_logs__count|pluralize }})</li>
                    {% endfor %}
                </ul>
            </div>
            <div class="span6">
                <h3>Least active users in the last 30 days</h3>
                <ul>
                    {% for user in least_active_users %}
                    <li><a href="mailto:{{ user.email }}">{{ user.email }}</a> (used on {{ user.activity_logs__count }} day{{ user.activity_logs__count|pluralize }})</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <h2>Searches <small>{{ total_searches }} total</small></h2>
        <div class="row-fluid">
            <div class="span12">
                <h3>Most searched datasets in the last 30 days</h3>
                <ul>
                    {% for dataset in most_searched_datasets %}
                    <li><a href="#dataset/{{ dataset.slug }}">{{ dataset.name }}</a> ({{ dataset.searches__count }} search{{ dataset.searches__count|pluralize:"es" }})</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <h3>Search count by day</h3>
                <ul>
                    <div id="searches-by-day" class="chart"></div>
                    {# {% for day in searches_by_day %} #}
                    {# <li>{{ day.day }} - {{ day.when__count }} search{{ day.when__count|pluralize:"es" }}</li> #}
                    {# {% endfor %} #}
                </ul>
            </div>
        </div>

        <h2>Disk usage</h2>
        <div class="row-fluid">
            <div class="span12">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Disk</th>
                            <th>Capacity</th>
                            <th>Remaining</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Root</td>
                            <td>{{ root_disk_total|filesizeformat }} ({{ root_disk_percent_used|floatformat:1 }}% used)</td>
                            <td>{{ root_disk_free|filesizeformat }}</td>
                        </tr>
                        <tr>
                            <td>Uploads (and exports)</td>
                            {% if upload_disk_total %}
                            <td>{{ upload_disk_total|filesizeformat }} ({{ upload_disk_percent_used|floatformat:1 }}% used)</td>
                            <td>{{ upload_disk_free|filesizeformat }}</td>
                            {% else %}
                            <td colspan="2">Uploads are currently stored on the root disk.</td>
                            {% endif %}
                        </tr>
                        <tr>
                            <td>Search indices</td>
                            {% if indices_disk_total %}
                            <td>{{ indices_disk_total|filesizeformat }} ({{ indices_disk_percent_used|floatformat:1 }}% used)</td>
                            <td>{{ indices_disk_free|filesizeformat }}</td>
                            {% else %}
                            <td colspan="2">Uploads are currently stored on the root disk.</td>
                            {% endif %}
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    /*var values = [];
    var labels = [];

    // Generate test data
    var n = 1 
    while (n < 30) {
        values.push(Math.floor(Math.random() * 100));
        labels.push(n);
        n += 1;
    }

    console.log(values);
    console.log(labels);

    var w = 960;
    var h = 150;
    var padding = 30;

    var x = d3.scale.ordinal()
        .domain(labels)
        .rangeBands([0, w]);

    var y = d3.scale.linear()
        .domain([0, d3.max(values)])
        .range([0, h]);

    var svg = d3.select("#searches-by-day").append("svg")
        .attr("width", w + padding * 2)
        .attr("height", h + padding * 2)

    var chart = svg.append("g")
        .attr("transform", "translate(" + padding + "," + padding + ")");

    chart.selectAll("rect")
        .data(values)
        .enter().append("rect")
            .attr("x", x)
            .attr("y", function(d) { return h - y(d) })
            .attr("width", x.rangeBand())
            .attr("height", y);

    svg.selectAll("text")
        .data(labels)
        .enter().append("text")
            .attr("x", function(d) { return x(d) + x.rangeBand() / 2; })
            .attr("y", h + padding + 16)
            .attr("text-anchor", "end")
            .text(String);*/

</script>

